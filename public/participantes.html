<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Participantes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* ===== VARIABLES CSS ===== */
        :root {
            --fondo-principal: #000000;
            --fondo-tarjetas: #1C1C1C;
            --texto-principal: #FFFFFF;
            --verde-neon: #00FF3C;
            --azul-secundario: #2196F3;
            --dorado-especial: #FFD700;
            --rojo-error: #ff4444;
            --gris-borders: #333333;
            --gris-hover: #444444;
            --gris-texto-secundario: #888888;
            
            --container-max-width: 800px;
            --container-padding: 20px;
            --border-radius-base: 10px;
            --border-radius-large: 15px;
            --border-radius-pill: 25px;
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
            --spacing-xl: 30px;
            --spacing-xxl: 40px;
            
            --shadow-light: 0 2px 5px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-heavy: 0 8px 25px rgba(0, 0, 0, 0.5);
            --shadow-neon: 0 0 20px rgba(0, 255, 60, 0.3);
            
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* ===== RESET Y BASE ===== */
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--fondo-principal);
            color: var(--texto-principal);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ===== NAVEGACI√ìN SUPERIOR ===== */
        .top-navigation {
            background-color: var(--fondo-tarjetas);
            padding: var(--spacing-md) 0;
            border-bottom: 2px solid var(--verde-neon);
            margin-bottom: var(--spacing-xl);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-links {
            max-width: var(--container-max-width);
            margin: 0 auto;
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            padding: 0 var(--spacing-lg);
        }

        .nav-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: var(--spacing-sm) var(--spacing-md);
            background-color: var(--gris-borders);
            color: var(--texto-principal);
            text-decoration: none;
            border-radius: var(--border-radius-pill);
            font-weight: bold;
            font-size: 14px;
            transition: all var(--transition-normal);
            border: 1px solid #555555;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background-color: var(--verde-neon);
            color: var(--fondo-principal);
            transform: translateY(-2px);
            box-shadow: var(--shadow-neon);
        }

        .nav-btn.gallery:hover {
            background-color: var(--dorado-especial);
            color: var(--fondo-principal);
        }

        .nav-btn.exit:hover {
            background-color: #ff5722;
            color: var(--texto-principal);
        }

        .nav-btn.arrival:hover {
            background-color: var(--azul-secundario);
            color: var(--texto-principal);
        }

        /* ===== CONTENEDOR PRINCIPAL ===== */
        .container {
            max-width: var(--container-max-width);
            margin: 0 auto;
            padding: var(--container-padding);
        }

        /* ===== HEADER ===== */
        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-xxl);
        }

        .page-header h1 {
            margin-bottom: var(--spacing-sm);
            color: var(--verde-neon);
            font-size: 2.2em;
            font-weight: bold;
        }

        .subtitle {
            color: var(--gris-texto-secundario);
            font-size: 16px;
            margin: 0;
        }

        /* ===== BOTONES ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius-pill);
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all var(--transition-normal);
            text-decoration: none;
            font-family: inherit;
        }

        .btn-primary {
            background-color: var(--verde-neon);
            color: var(--fondo-principal);
            box-shadow: 0 4px 15px rgba(0, 255, 60, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #00cc33;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 60, 0.4);
        }

        .btn-secondary {
            background-color: var(--azul-secundario);
            color: var(--texto-principal);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #1976d2;
            transform: translateY(-2px);
        }

        .btn-special {
            background-color: var(--dorado-especial);
            color: var(--fondo-principal);
        }

        .btn-special:hover:not(:disabled) {
            background-color: #e6c200;
            transform: translateY(-2px);
        }

        /* ===== GRID DE ACCIONES R√ÅPIDAS ===== */
        .quick-actions {
            margin-top: var(--spacing-xxl);
            padding-top: var(--spacing-xl);
            border-top: 1px solid var(--gris-borders);
        }

        .quick-actions h3 {
            text-align: center;
            color: var(--verde-neon);
            margin-bottom: var(--spacing-lg);
            font-size: 1.3em;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        .action-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-lg);
            background-color: var(--fondo-tarjetas);
            border: 1px solid var(--gris-borders);
            border-radius: var(--border-radius-base);
            text-decoration: none;
            color: inherit;
            transition: all var(--transition-normal);
        }

        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-neon);
            border-color: var(--verde-neon);
        }

        .action-icon {
            font-size: 24px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            flex-shrink: 0;
            font-weight: bold;
        }

        .action-card:nth-child(1) .action-icon {
            background-color: var(--verde-neon);
            color: var(--fondo-principal);
        }

        .action-card:nth-child(2) .action-icon {
            background-color: var(--dorado-especial);
            color: var(--fondo-principal);
        }

        .action-card:nth-child(3) .action-icon {
            background-color: var(--azul-secundario);
            color: var(--texto-principal);
        }

        .action-content h4 {
            margin: 0 0 5px 0;
            color: var(--verde-neon);
            font-size: 16px;
        }

        .action-content p {
            margin: 0;
            color: #cccccc;
            font-size: 14px;
            line-height: 1.4;
        }

        /* ===== FOOTER ===== */
        .page-footer {
            margin-top: var(--spacing-xxl);
            padding: var(--spacing-lg);
            text-align: center;
            background-color: var(--fondo-tarjetas);
            border-radius: var(--border-radius-base);
            border: 1px solid var(--gris-borders);
        }

        .page-footer p {
            margin: 0;
            color: var(--gris-texto-secundario);
            font-size: 14px;
        }

        .page-footer strong {
            color: var(--verde-neon);
        }

        /* ===== ESTILOS ESPEC√çFICOS DE PARTICIPANTES ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }
        
        .stat-card {
            background: var(--fondo-tarjetas);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-base);
            text-align: center;
            border: 2px solid var(--dorado-especial);
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-light);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dorado-especial);
        }
        
        .stat-label {
            color: var(--texto-principal);
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .controls {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .success-message {
            background: var(--verde-neon);
            color: var(--fondo-principal);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-base);
            margin: var(--spacing-lg) 0;
            display: none;
            font-weight: bold;
            text-align: center;
            animation: slideInUp 0.5s ease;
        }
        
        .preview {
            background: var(--fondo-tarjetas);
            border-radius: var(--border-radius-base);
            padding: var(--spacing-lg);
            border: 1px solid var(--gris-borders);
            box-shadow: var(--shadow-light);
        }
        
        .preview h3 {
            color: var(--verde-neon);
            margin: 0 0 var(--spacing-md) 0;
        }
        
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: var(--border-radius-base);
            border: 1px solid var(--gris-borders);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--fondo-principal);
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--gris-borders);
            color: var(--texto-principal);
        }
        
        th {
            background: var(--verde-neon);
            color: var(--fondo-principal);
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:nth-child(even) {
            background-color: var(--fondo-tarjetas);
        }
        
        tr:hover {
            background-color: rgba(0, 255, 60, 0.1);
        }
        
        .category {
            font-weight: bold;
            color: var(--dorado-especial);
        }

        /* Mejorar la barra de scroll */
        .table-container::-webkit-scrollbar {
            width: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: var(--gris-borders);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: var(--verde-neon);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: #00cc33;
        }

        /* ===== ESTILOS DE B√öSQUEDA Y FILTROS ===== */
        .search-filters {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        .filter-box {
            flex: 0 0 auto;
            min-width: 200px;
        }

        .search-input, .filter-select {
            width: 100%;
            padding: 12px 16px;
            background-color: var(--fondo-principal);
            border: 2px solid var(--gris-borders);
            border-radius: var(--border-radius-pill);
            color: var(--texto-principal);
            font-size: 14px;
            font-family: inherit;
            transition: all var(--transition-normal);
        }

        .search-input:focus, .filter-select:focus {
            outline: none;
            border-color: var(--verde-neon);
            box-shadow: 0 0 0 3px rgba(0, 255, 60, 0.1);
        }

        .search-input::placeholder {
            color: var(--gris-texto-secundario);
        }

        .filter-select {
            cursor: pointer;
        }

        .filter-select option {
            background-color: var(--fondo-principal);
            color: var(--texto-principal);
        }

        .clear-btn {
            flex: 0 0 auto;
            white-space: nowrap;
        }

        .results-counter {
            background-color: var(--fondo-principal);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-base);
            border: 1px solid var(--gris-borders);
            margin-bottom: var(--spacing-md);
            text-align: center;
            font-size: 14px;
            color: var(--gris-texto-secundario);
        }

        .results-counter span {
            font-weight: bold;
            color: var(--verde-neon);
        }

        /* ===== ANIMACIONES ===== */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-md);
            }
            
            .nav-links {
                flex-direction: column;
                align-items: center;
                gap: var(--spacing-sm);
            }
            
            .nav-btn {
                width: 100%;
                max-width: 200px;
                justify-content: center;
            }
            
            .page-header h1 {
                font-size: 1.8em;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
            
            .action-card {
                padding: var(--spacing-md);
            }
            
            .action-icon {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .controls .btn {
                width: 100%;
                max-width: 250px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .stat-number {
                font-size: 1.5em;
            }
            
            th, td {
                padding: 8px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            :root {
                --container-padding: 10px;
                --spacing-xl: 20px;
                --spacing-xxl: 30px;
            }
            
            .top-navigation {
                padding: var(--spacing-sm) 0;
                margin-bottom: var(--spacing-lg);
            }
            
            .nav-links {
                padding: 0 var(--spacing-sm);
            }
            
            .page-header h1 {
                font-size: 1.6em;
            }
            
            .subtitle {
                font-size: 14px;
            }
            
            .preview {
                padding: var(--spacing-md);
            }
            
            .stat-card {
                padding: var(--spacing-md);
            }
            
            .search-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box, .filter-box {
                min-width: auto;
            }
        }

        /* ===== UTILIDADES ===== */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Navegaci√≥n est√°ndar -->
    <nav class="top-navigation">
        <div class="nav-links">
            <a href="/" class="nav-btn home">üè† Home</a>
            <a href="/galeria" class="nav-btn gallery">üñºÔ∏è Galer√≠a QR</a>
            <a href="/salida" class="nav-btn exit">üèÉ‚Äç‚ôÇÔ∏è Registrar Salida</a>
            <a href="/llegada" class="nav-btn arrival">üèÅ Registrar Llegada</a>
            <a href="/tiempos" class="nav-btn arrival">‚è∞ Tiempos</a>
            <a href="/participantes" class="nav-btn">üë• Participantes</a>
        </div>          
    </nav>

    <!-- Contenedor est√°ndar -->
    <div class="container">
        <!-- Header est√°ndar -->
        <header class="page-header">
            <h1>üìä Lista de Participantes</h1>
            <p class="subtitle">Gestiona y descarga la informaci√≥n de todos los participantes registrados</p>
        </header>

        <!-- Estad√≠sticas -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalParticipants"></div>
                <div class="stat-label">Total Participantes</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalMen">79</div>
                <div class="stat-label">Hombres</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalWomen">62</div>
                <div class="stat-label">Mujeres</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">6</div>
                <div class="stat-label">Categor√≠as</div>
            </div>
        </section>

        <!-- Controles de descarga -->
        <section class="controls">
            <button onclick="downloadExcel()" class="btn btn-special">
                üì• Descargar Excel
            </button>
            <button onclick="downloadCSV()" class="btn btn-secondary">
                üìÑ Descargar CSV
            </button>
        </section>
        
        <!-- Mensaje de √©xito -->
        <div id="successMessage" class="success-message">
            ‚úÖ Archivo descargado exitosamente!
        </div>
        
        <!-- Vista previa de datos -->
        <section class="preview">
            <h3>üìã Vista previa de participantes:</h3>
            
            <!-- Controles de b√∫squeda y filtros -->
            <div class="search-filters">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç Buscar por nombre..." class="search-input">
                </div>
                <div class="filter-box">
                    <select id="categoryFilter" class="filter-select">
                        <option value="">üìÇ Todas las categor√≠as</option>
                        <option value="Principiante Masculino">Principiante Masculino</option>
                        <option value="Intermedio Masculino">Intermedio Masculino</option>
                        <option value="Avanzado Masculino">Avanzado Masculino</option>
                        <option value="Principiante Femenino">Principiante Femenino</option>
                        <option value="Intermedio Femenino">Intermedio Femenino</option>
                        <option value="Avanzado Femenino">Avanzado Femenino</option>
                    </select>
                </div>
                <button onclick="clearFilters()" class="btn btn-secondary clear-btn">
                    üóëÔ∏è Limpiar
                </button>
            </div>
            
            <!-- Contador de resultados -->
            <div class="results-counter">
                <span id="resultsCount">Mostrando 141 de 141 participantes</span>
            </div>
            
            <div class="table-container">
                <table id="participantsTable">
                    <thead>
                        <tr>
                            <th>N√∫mero</th>
                            <th>Categor√≠a</th>
                            <th>Nombre</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Los datos se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Acciones r√°pidas -->
        <div class="quick-actions">
            <h3>üöÄ Acciones R√°pidas</h3>
            <div class="actions-grid">
                <a href="/" class="action-card">
                    <div class="action-icon">‚úçÔ∏è</div>
                    <div class="action-content">
                        <h4>Registrar Participante</h4>
                        <p>Agregar nuevo participante al evento</p>
                    </div>
                </a>
                
                <a href="/galeria" class="action-card">
                    <div class="action-icon">üñºÔ∏è</div>
                    <div class="action-content">
                        <h4>Ver Galer√≠a QR</h4>
                        <p>Explorar c√≥digos QR generados</p>
                    </div>
                </a>
                
                <a href="/tiempos" class="action-card">
                    <div class="action-icon">‚è±Ô∏è</div>
                    <div class="action-content">
                        <h4>Ver Tiempos</h4>
                        <p>Resultados y estad√≠sticas del evento</p>
                    </div>
                </a>
            </div>
        </div>

        <!-- Footer est√°ndar -->
        <footer class="page-footer">
            <p>üí° <strong>Tip:</strong> Los archivos descargados incluyen todos los participantes organizados por categor√≠a</p>
        </footer>
    </div>

    <script>
        // Datos de los participantes organizados por categor√≠a
        const API_URL = '/api/participantes';

  // Estado global
        console.log('HELLLLOOOOOOOOOOO')

        // Variables globales para filtros
        let participantes = [];
        let filteredParticipants = [...participantes];
        let currentSearchTerm = '';
        let currentCategoryFilter = '';

        async function cargarParticipantes() {
            console.log('HOLAAAAAAAAAAaaA')
    try {
      const res = await fetch(API_URL, { headers: { 'Accept': 'application/json' } });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      // La API responde { participantes: [...] }
      participantes = (data?.participantes ?? []).map(p => ({
        numero: p?.numero ?? '',
        categoria: p?.categoria ?? '',
        nombre: p?.nombre ?? '',
        talla: p?.talla ?? ''
      }));
      filteredParticipants = [...participantes];

      // Render inicial y listeners
      populateTable(participantes);
      setupEventListeners();
    } catch (err) {
      console.error('Error al cargar participantes:', err);
      alert('‚ùå No se pudieron cargar los participantes');
    }
  }

        // Llenar la tabla con los datos (modificada para usar datos filtrados)
        function populateTable(dataToShow = participantes) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            dataToShow.forEach(participante => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${participante.numero.toString().padStart(3, '0')}</td>
                    <td class="category">${participante.categoria}</td>
                    <td>${participante.nombre}</td>
                    <td>${participante.talla}</td>
                `;
            });

            // Actualizar contador de resultados
            updateResultsCounter(dataToShow.length);

        }

        // Actualizar contador de resultados
        function updateResultsCounter(filteredCount) {
            const counter = document.getElementById('resultsCount');
            const totalCount = participantes.length;

            const totalText = document.getElementById('totalParticipants');
            totalText.textContent = totalCount;

            const menCount = participantes.filter(p => p.categoria.includes('Masculino')).length;
            const womenCount = participantes.filter(p => p.categoria.includes('Femenino')).length;
            document.getElementById('totalMen').textContent = menCount;
            document.getElementById('totalWomen').textContent = womenCount;

            counter.textContent = `Mostrando ${filteredCount} de ${participantes.length} participantes`;
        }

        // Funci√≥n de b√∫squeda por nombre
        function searchByName(searchTerm) {
            currentSearchTerm = searchTerm.toLowerCase();
            applyFilters();
        }

        // Funci√≥n de filtro por categor√≠a
        function filterByCategory(category) {
            currentCategoryFilter = category;
            applyFilters();
        }

        // Aplicar todos los filtros
        function applyFilters() {
            filteredParticipants = participantes.filter(participante => {
                const matchesName = currentSearchTerm === '' || 
                    participante.nombre.toLowerCase().includes(currentSearchTerm);
                const matchesCategory = currentCategoryFilter === '' || 
                    participante.categoria === currentCategoryFilter;
                
                return matchesName && matchesCategory;
            });

            populateTable(filteredParticipants);
            updateFilteredStats();
        }

        // Actualizar estad√≠sticas seg√∫n los filtros
        function updateFilteredStats() {
            const totalFiltered = filteredParticipants.length;
            const menFiltered = filteredParticipants.filter(p => 
                p.categoria.includes('Masculino')).length;
            const womenFiltered = filteredParticipants.filter(p => 
                p.categoria.includes('Femenino')).length;

            // Actualizar los n√∫meros en las tarjetas de estad√≠sticas
            document.getElementById('totalParticipants').textContent = totalFiltered;
            document.getElementById('totalMen').textContent = menFiltered;
            document.getElementById('totalWomen').textContent = womenFiltered;
        }

        // Limpiar todos los filtros
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            currentSearchTerm = '';
            currentCategoryFilter = '';
            filteredParticipants = [...participantes];
            populateTable(participantes);
            
            // Restaurar estad√≠sticas originales
            document.getElementById('totalParticipants').textContent = '141';
            document.getElementById('totalMen').textContent = '79';
            document.getElementById('totalWomen').textContent = '62';
        }

        // Event listeners para los controles de filtro
        function setupEventListeners() {
            // B√∫squeda en tiempo real
            document.getElementById('searchInput').addEventListener('input', function(e) {
                searchByName(e.target.value);
            });

            // Filtro por categor√≠a
            document.getElementById('categoryFilter').addEventListener('change', function(e) {
                filterByCategory(e.target.value);
            });
        }

        // Funci√≥n para mostrar mensaje de √©xito
        function showSuccessMessage() {
            const message = document.getElementById('successMessage');
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 3000);
        }

        // Funci√≥n para descargar Excel (modificada para usar datos filtrados)
        function downloadExcel() {
            const dataToExport = filteredParticipants.length < participantes.length ? 
                filteredParticipants : participantes;
                
            const ws = XLSX.utils.json_to_sheet(dataToExport.map(p => ({
                'N√∫mero': p.numero.toString().padStart(3, '0'),
                'Categor√≠a': p.categoria,
                'Nombre': p.nombre,
                'Talla': p.talla
            })));

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Participantes");

            // Configurar ancho de columnas
            ws['!cols'] = [
                {wch: 8},  // N√∫mero
                {wch: 25}, // Categor√≠a
                {wch: 35}, // Nombre
                {wch: 8}   // Talla
            ];

            const fileName = filteredParticipants.length < participantes.length ? 
                "Lista_Participantes_Filtrada.xlsx" : "Lista_Participantes.xlsx";
                
            XLSX.writeFile(wb, fileName);
            showSuccessMessage();
        }

        // Funci√≥n para descargar CSV (modificada para usar datos filtrados)
        function downloadCSV() {
            const dataToExport = filteredParticipants.length < participantes.length ? 
                filteredParticipants : participantes;
                
            const csvContent = [
                ['N√∫mero', 'Categor√≠a', 'Nombre', 'Talla'],
                ...dataToExport.map(p => [
                    p.numero.toString().padStart(3, '0'),
                    p.categoria,
                    p.nombre,
                    p.talla
                ])
            ].map(row => row.map(field => `"${field}"`).join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const fileName = filteredParticipants.length < participantes.length ? 
                "Lista_Participantes_Filtrada.csv" : "Lista_Participantes.csv";
            
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccessMessage();
        }

        // Inicializar la tabla al cargar la p√°gina
        window.onload = function() {
            populateTable();
            setupEventListeners();
            cargarParticipantes();
        };
    </script>
</body>
</html>